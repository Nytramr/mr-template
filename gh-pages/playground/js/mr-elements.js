!function(){"use strict";const e={"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`"};function t(e){if(e instanceof Node)return e;return document.createTextNode(e)}class n extends HTMLElement{static get observedAttributes(){return["text"]}#e;#t=new mrTemplate.Parser("My template");#n;#o=0;#i(e){e.length>0&&this.dispatchEvent(new CustomEvent("mr-template-editor-error",{detail:{errors:e},bubbles:!0,composed:!0}))}#r(e,t=!1,n=this.#e){if(!n)return null;if(n.nodeType===Node.TEXT_NODE)return e<=n.length?[n,e]:null;for(let o of n.childNodes){if(0===e&&!t)return[o,0];let n=o.textContent.length||("BR"===o.nodeName?1:0);if(t&&e===n)return[o,o.length||o.childNodes.length];if(e<n+(t?1:0))return this.#r(e,t,o);e-=n}return null}#s(){this.#e.querySelectorAll(".error").forEach(e=>{e.classList.remove("error"),e.removeAttribute("title")})}#l=()=>{this.#s();try{this.#t.tokenize(this.#e.innerText).verify(),this.dispatchEvent(new CustomEvent("mr-template-editor-change",{bubbles:!0,composed:!0}))}catch(e){this.#i(this.#t.errors)}finally{let e=[...this.#t.tokens],t=e.pop();for(;t;)t.errors.forEach(e=>{let[t,n,o,[i,r]]=e,s=this.#r(i),l=this.#r(r,!0);if(s&&l){let e=document.createRange();e.setStart(s[0],s[1]),e.setEnd(l[0],l[1]);let n=document.createElement("span");"SPAN"===e.commonAncestorContainer.nodeName?n=e.commonAncestorContainer:e.surroundContents(n),n.classList.toggle("error",!0),n.setAttribute("title",t)}}),t=e.pop();this.#e.normalize()}};#a=null;#c=100;#d(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,requestAnimationFrame(this.#l)},this.#c)}#h=t=>{if("insertText"===t.inputType){let n=e[t.data];if(n){let e=this.shadowRoot.getSelection();if(e.rangeCount>0){let o=e.getRangeAt(0),i=o.cloneRange();i.collapse(),o.collapsed||(this.#n=o.cloneRange(),this.#o=o.startOffset+t.data.length,o.collapse(!0),e.removeAllRanges(),e.addRange(o)),i.insertNode(document.createTextNode(n)),t.stopPropagation()}}}};#u=e=>{if(this.#d(),this.#n){let e=this.shadowRoot.getSelection();this.#n.setStart(this.#n.startContainer,this.#o),e.removeAllRanges(),e.addRange(this.#n),this.#n=null}};get templateTrees(){return this.#t.getTrees()}get carets(){const e=this.shadowRoot.getSelection();return e&&0!==e.rangeCount?Array.from(e.getRangeAt(0).getClientRects()).map(e=>({left:e.left,top:e.top,width:e.width,height:e.height})):[]}get innerText(){return this.#e.innerText}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n      <style>\n        * {\n          margin: 0;\n          box-sizing: border-box;\n        }\n\n        :host {\n          display: block;\n        }\n\n        .code-container {\n          position: relative;\n          height: 100%;\n          border-radius: 2px;\n          overflow-y: auto;\n          \n          & > pre {\n            outline: none;\n            white-space: normal;\n            min-height: 100%;\n\n            & .error {\n              text-decoration: red wavy underline;\n              text-decoration-skip-ink: none;\n            }\n          }\n\n          &:focus-within {\n            outline: 2px solid;\n            outline-color: Highlight;\n            outline-color: -webkit-focus-ring-color;\n            outline-offset: 2px;\n          }\n\n          & > .highlight {\n            position: absolute;\n            width: 200px;\n            height: 1rem;\n\n            &:hover {\n              background-color: rgba(255, 255, 0, 0.2);\n            }\n          }\n        }\n      </style>\n      <div class="code-container">\n        <pre id="editor" contenteditable="plaintext-only" spellcheck="false"></pre>\n      </div>\n    ',this.#e=this.shadowRoot.querySelector("#editor")}attributeChangedCallback(e,t,n){"text"===e&&t!==n&&(this.#e.innerText=n,this.#d())}connectedCallback(){this.#e.addEventListener("beforeinput",this.#h),this.#e.addEventListener("input",this.#u)}disconnectedCallback(){this.#e.removeEventListener("beforeinput",this.#h),this.#e.removeEventListener("input",this.#u)}surroundContents(e,n=void 0){let o=this.shadowRoot.getSelection();if(o.rangeCount>0){let i=o.getRangeAt(0);if(n){let e=i.cloneRange();e.collapse(),e.insertNode(t(n))}let r=t(e);i.insertNode(r),o.setPosition(r.nextSibling),this.#d()}}getSelection(){let e=this.shadowRoot.getSelection();if(e.rangeCount)return e.getRangeAt(0)}}customElements.define("mr-template-editor",n)}();
